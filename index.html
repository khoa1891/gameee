<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>H·ªçc T·ª´ V·ª±ng</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f3f7f6;
    }
    .wrapper {
      padding: 10px;
      max-width: 480px;
      margin: auto;
    }
    h2 {
      text-align: center;
      background: #4caf50;
      color: white;
      padding: 10px;
      border-radius: 10px;
    }
    .controls {
      display: flex;
      /* justify-content: center; */
      /* margin: 10px 0; */
  overflow-x: auto;
  gap: 10px;
  padding: 8px;
    }
    button {
      background: #2196f3;
      color: white;
      /* padding: 10px 14px; */
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;

      padding: 12px;
  font-size: 16px;
  width: 100%;
  border-radius: 10px;
    }
  

    button.active {
      background: #1769aa;
    }
    .marked-info {
      text-align: center;
      margin-bottom: 8px;
      font-style: italic;
      color: #333;
    }
    .card-container {
      max-height: 380px;
      overflow-y: auto;
      padding: 5px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .card-wrapper {
      perspective: 1000px;
    }
    .card {
      width: 100%;
      height: 80px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s ease, background 0.3s ease, border 0.3s ease;
      cursor: pointer;
      border-radius: 10px;
    }
    .card.flipped {
      transform: rotateY(180deg);
    }
    .card.marked {
  background-color: #fff3cd; /* m√†u n·ªÅn v√†ng nh·∫°t */
  border: 2px solid #f0ad4e;
  transition: background-color 0.3s ease, border 0.3s ease;
}
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .card-front {
      background: white;
    }
    .card {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 10px;
  perspective: 1000px;
  transition: transform 0.6s;
  cursor: pointer;
}
.card.lat .mat-truoc {
  display: none;
}
.card.lat .mat-sau {
  display: block;
}
.mat-sau {
  display: none;
  color: blue;
}
    .card-back {
      background: #e3f2fd;
      transform: rotateY(180deg);
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      font-size: 14px;
    }
    .checkbox {
      margin-left: auto;
    }
    .t√≠nh-t·ª´ .card-front { border-left: 6px solid #4caf50; }
    .tr·∫°ng-t·ª´ .card-front { border-left: 6px solid #ff9800; }
    .danh-t·ª´ .card-front { border-left: 6px solid #3f51b5; }
    .ƒë·ªông-t·ª´ .card-front { border-left: 6px solid #e91e63; }
    .marked {
      background: #fff3e0 !important;
      border: 2px solid orange !important;
    }
    .pagination-container {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      padding: 8px;
      background: #e0e0e0;
      border: 1px solid #bbb;
      border-radius: 12px;
      gap: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-wrap: wrap;
    }
    .page-number {
      padding: 6px 10px;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid #ccc;
    }
    .page-number.active {
      background: #2196f3;
      color: white;
      font-weight: bold;
    }
    .no-data {
      text-align: center;
      font-style: italic;
      color: #888;
      margin-top: 20px;
    }
    .card-front .bqt-span {
  color: orange;
  font-weight: bold;
  font-size: 14px;
  margin-bottom: 4px;
  /* text-transform: uppercase; */
  display: block;
}
  </style>

  <!-- b·∫£ng ch·ªØ c√°i -->
   <style>
    .loadingg {
      margin-top: 50px;
      font-size: 1.2rem;
      animation: spin 1s linear infinite;
      
    }
    .loading { display: none}

    @keyframes spin {
      0% { opacity: 0.2; }
      50% { opacity: 1; }
      100% { opacity: 0.2; }
    }

    .speed-control {
      margin-bottom: 1rem;
      font-size: 1rem;
      display: none
    }

    #alphabetGrid {
      display: none

    }
    .gridABC {
      display: grid;
      /* grid-template-columns: repeat(6, 50px); */
  grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));

      gap: 10px;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 0.5s ease, transform 0.5s ease;

  grid-template-columns: repeat(5, 1fr); /* mobile v·ª´a ƒë·ªß */
  justify-content: center;
  padding: 10px;
  max-width: 100%;
    }


    .gridABC.show {
      opacity: 1;
      transform: scale(1);
    }

    /* .letter {
  background: white;
  color: #333;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  text-align: center;
  padding: 16px 8px;
  font-size: 20px;
  cursor: pointer;
  font-weight: bold;
  transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
  user-select: none;
} */


.letter {
    background: #282828;
    /* background: #282828; */
    color: white;
    border-radius: 10px;
    text-align: center;
    padding: 10px;
    font-size: 20px;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    font-weight: bold;
}





    input[type="range"] {
      width: 200px;
    }
    #phoneticKeyboard button {
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin: 2px;
  cursor: pointer;
  background: #f0f0f0;
}


.letter {
  background: white;
  background: #282828;
  color: black;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  padding: 12px;
  text-align: center;
  font-weight: bold;
  cursor: pointer;
  border:border 1px;
  transition: transform 0.2s;
}
/* .letter:hover {
  transform: scale(1.05);
  background: #e3f2fd;
} */
.letter:hover {
  transform: scale(1.05);
  background: #e3f2fd;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}


.letter:active {
  transform: scale(0.95);
  background: #bbdefb;
}

.letter small {
  display: block;
  color: #888;
  font-size: 14px;
  margin-top: 6px;
}


   </style>
   <style>
    /* Input and buttons inline */
    .input-group {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }
    .input-group input {
      flex: 1;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .input-group button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: #2196f3;
      color: white;
      cursor: pointer;
    }
  
    /* Phonetic keyboard scrollable */
    #phoneticKeyboard {
      display: none;
      overflow-x: auto;
      white-space: nowrap;
      padding: 4px 0;
      margin-bottom: 8px;
    }
    #phoneticKeyboard button {
      display: inline-block;
      margin-right: 4px;
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #f0f0f0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h2>H·ªçc T·ª´ V·ª±ng</h2>
    <div class="controls">
      <button id="btnStudy" onclick="showTab('study')">H·ªçc</button>
      <button id="btnMarked" onclick="showTab('marked')">Xem ƒê√£ ƒê√°nh D·∫•u</button>
      
      <button onclick="showTab('bqt')" id="nutBatDauHoc" class="nut-tab">ƒê·ªông T·ª´ BQT</button>
      <button onclick="xoaBoNho()">üîÑ X√≥a & Reload</button>
      <button onclick="showTab('bangChuCai')">B·∫£ng Ch·ªØ C√°i</button>

      <!-- <button onclick="batDauHoc()" id="nutBatDauHoc" class="nut-tab">ƒê·ªông T·ª´ BQT</button> -->
    </div>
    <div class="marked-info" id="markedInfo"></div>
    <div class="card-container" id="cardContainer"></div>
    <div class="pagination-container" id="pagination"></div>
    <!-- <div id="tab-bqt" class="tab" style="display: none;">
  <h2>ƒê·ªông T·ª´ B·∫•t Quy T·∫Øc</h2>
  <p id="soTuBQT">ƒê√£ h·ªçc: 0/100</p>
  <div id="dsBQT"></div>
  <button id="nutOanTuTi" onclick="batDauOanTuTi()">O·∫≥n T√π T√¨</button>
  <div id="khungChatOanTuTi" style="display: none;">
    <div id="lichSuChatOanTuTi" style="max-height: 200px; overflow-y: auto; background: #eee; padding: 10px; margin: 10px 0;"></div>
    <div>
      <button onclick="chonOanTuTi('k√©o')">K√©o</button>
      <button onclick="chonOanTuTi('b√∫a')">B√∫a</button>
      <button onclick="chonOanTuTi('bao')">Bao</button>
    </div>
  </div>
</div> -->
<p id="soTuBQT">ƒê√£ h·ªçc: 0/0</p>

<div id="dsBQT" style='background: red; height: 900px;
overflow-y: auto; '></div>
<button id="nutOanTuTi" onclick="batDauOanTuTi()" style="display:none;">Ch∆°i O·∫≥n T√π T√¨</button>  
<div id="khungChatOanTuTi">
  <div class="dong-chat-top">
    <strong id="huongDan">H√£y ch·ªçn, m√°y s·∫Ω ch∆°i c√πng b·∫°n.</strong>
    <button onclick="dongChat()">ƒê√≥ng</button>
  </div>
  <div id="lichSuChatOanTuTi"></div>
  <div>
    <button id="btnKeo" class="chon" onclick="chonOanTuTi('k√©o')">‚Ä¢ K√©o</button>
    <button id="btnBua" class="chon" onclick="chonOanTuTi('b√∫a')">‚Ä¢ B√∫a</button>
    <button id="btnBao" class="chon" onclick="chonOanTuTi('bao')">‚Ä¢ Bao</button>
  </div>
</div> 

<div id="tab-bangChuCai" class="tab" style="display: none;"><button onclick="batDauLuyenNghe()" style="margin-top: 20px;">B·∫Øt ƒë·∫ßu Luy·ªán Nghe</button>
  <div id="popupLuyenNghe" style="display: none; position: fixed; top:0; left:0;
  width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999;
   align-items: center; justify-content: center;">
<div style="background:white; padding:20px; border-radius:12px; width:90%; max-width:400px;">
  <button onclick="dongLuyenNghe()" style="float:right;">‚úñ</button>

  <!-- INFO V√íNG/ C√ÇU H·ªéI -->
  <div id="infoCycle" style="font-weight:bold; margin-bottom:10px;"></div>

  <h3 id="cauHoiPopup"></h3>
  <button onclick="playAudio()" style="margin:10px 0;">Nghe</button><br>

  <!-- INPUT & TOGGLE B√ÄN PH√çM -->
  <!-- <input id="cauTraLoi" type="text" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." style="width:100%; padding:8px; font-size:16px;"> -->
  <!-- <button id="toggleKeyboard" style="margin:8px 0;">Chuy·ªÉn B·∫£ng Ph√≠m</button> -->

  <div class="input-group">
    <input id="cauTraLoi" type="text" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    <button id="toggleKeyboard">üî§</button>
    <button onclick="kiemTraCauTraLoi()">G·ª≠i</button>
  </div>
  <div id="phoneticKeyboard"></div>
  <!-- <div id="phoneticKeyboard" style="display:none; margin-bottom:8px; flex-wrap:wrap; gap:6px;"></div> -->

  <!-- <button onclick="kiemTraCauTraLoi()" style="margin-top:10px;">G·ª≠i</button> -->
  <p id="thongBao" style="font-weight:bold; font-size:18px; margin-top:12px;"></p>
</div>
</div>

<script>
   let danhSachNghe = [];
let cauHoiIndex = 0;
let cauHoiHienTai = null;

// function batDauLuyenNghe() {
//   cauHoiIndex = 0;
//   danhSachNghe = [];

//   alphabet.forEach(item => {
//     danhSachNghe.push({ kieu: "chu", hien: item.letter, traLoi: item.letter.toLowerCase() });
//     danhSachNghe.push({ kieu: "phienam", hien: item.letter, traLoi: item.phonetic.toLowerCase() });
//   });

//   danhSachNghe = danhSachNghe.sort(() => Math.random() - 0.5);

//   document.getElementById("popupLuyenNghe").style.display = "flex";
//   hienCauHoi();
// }

function hienCauHoi() {
  if (cauHoiIndex >= danhSachNghe.length) {
    document.getElementById("popupLuyenNghe").innerHTML = `<div style="color:white;font-size:24px;text-align:center;">ƒê√£ ho√†n th√†nh!</div>`;
    return;
  }

  cauHoiHienTai = danhSachNghe[cauHoiIndex];
  const cau = (cauHoiHienTai.kieu === "chu") ? "ƒê√¢y l√† t·ª´ g√¨?" : "Phi√™n √¢m c·ªßa t·ª´ n√†y l√† g√¨?";
  document.getElementById("cauHoiPopup").innerText = cau;
  document.getElementById("cauTraLoi").value = "";
  document.getElementById("thongBao").innerText = "";
}

const speedInput = document.getElementById("speed");
const speedDisplay = document.getElementById("speedDisplay");
let voices = [];
// function speak(text) {
//   if (!voices.length) return;
//   const utter = new SpeechSynthesisUtterance(text);
//   utter.lang = "en-US";
//   utter.voice = voices[0];
//   console.log(2222)
//   utter.rate = speedInput.value / 100;
//   speechSynthesis.speak(utter);
// }

function speak(text) {
  if (!voices.length) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  utter.voice = voices[0];

  const speedInput = document.getElementById("speed");
  utter.rate = speedInput ? speedInput.value / 100 : 1;

  speechSynthesis.speak(utter);
}
function loadVoiceAndThenBuild() {
  voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith("en"));

  if (!voices.length) {
    setTimeout(loadVoiceAndThenBuild, 200);
  } else {
    buildAlphabetGrid(); // ch·ªâ g·ªçi sau khi voice c√≥
  }
}


function playAudio() {
  const voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith("en"));
  if (!voices.length) {
    alert("Ch∆∞a load ƒë∆∞·ª£c voice, th·ª≠ l·∫°i sau.");
    return;
  }
  const utter = new SpeechSynthesisUtterance(cauHoiHienTai.hien);
  utter.voice = voices[0];
  utter.lang = "en-US";
  const speedInput = document.getElementById("speed");
  utter.rate = speedInput ? speedInput.value / 100 : 1;
  speechSynthesis.speak(utter);
}
const alphabet = [
      { letter: "A", phonetic: "ei" },
      { letter: "B", phonetic: "biÀê" },
      { letter: "C", phonetic: "siÀê" },
      { letter: "D", phonetic: "diÀê" },
      { letter: "E", phonetic: "iÀê" },
      { letter: "F", phonetic: "ef" },
      { letter: "G", phonetic: "d íiÀê" },
      { letter: "H", phonetic: "e…™t É" },
      { letter: "I", phonetic: "a…™" },
      { letter: "J", phonetic: "d íe…™" },
      { letter: "K", phonetic: "ke…™" },
      { letter: "L", phonetic: "el" },
      { letter: "M", phonetic: "em" },
      { letter: "N", phonetic: "en" },
      { letter: "O", phonetic: "o ä" },
      { letter: "P", phonetic: "piÀê" },
      { letter: "Q", phonetic: "kjuÀê" },
      { letter: "R", phonetic: "…ëÀêr" },
      { letter: "S", phonetic: "es" },
      { letter: "T", phonetic: "tiÀê" },
      { letter: "U", phonetic: "juÀê" },
      { letter: "V", phonetic: "viÀê" },
      { letter: "W", phonetic: "Ààd åb…ôl.juÀê" },
      { letter: "X", phonetic: "eks" },
      { letter: "Y", phonetic: "wa…™" },
      { letter: "Z", phonetic: "ziÀê" }
    ];


function kiemTraCauTraLoi() {
  const input = document.getElementById("cauTraLoi").value.trim().toLowerCase();
  const tb = document.getElementById("thongBao");

  if (!input) {
    tb.innerText = "B·∫°n ch∆∞a nh·∫≠p g√¨!";
    tb.style.color = "orange";
    return;
  }

  const dung = input === cauHoiHienTai.traLoi;
  if (dung) {
    tb.innerText = "ƒê√∫ng!";
    tb.style.color = "green";
  } else {
    tb.innerHTML = `Sai! ƒê√°p √°n ƒë√∫ng l√†: <b>${cauHoiHienTai.traLoi}</b>`;
    tb.style.color = "red";
  }


 
   
  const gridABC = document.getElementById("alphabetGrid");


function loadVoices() {
voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith("en"));
if (voices.length) {
// loading.style.display = "none";
gridABC.classList.add("show");
} else {
// ƒë·ª£i 200ms r·ªìi th·ª≠ l·∫°i
setTimeout(loadVoices, 200);
}
}


window.speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();





// alphabet.forEach(item => {
//   const div = document.createElement("div");
//   div.className = "letter";
//   // div.innerHTML = `
//   //   ${item.letter}<br><small>${item.phonetic}</small>
//   // `;
//   div.addEventListener("click", () => speak(item.letter));
//   gridABC.appendChild(div);
// });

speedInput.addEventListener("input", () => {
  speedDisplay.textContent = `${speedInput.value}%`;
});
  setTimeout(() => {
    cauHoiIndex++;
    hienCauHoi();
  }, 2000);
}
</script>
    
</div>
<div class="speed-control">
  T·ªëc ƒë·ªô ƒë·ªçc: <span id="speedDisplay">100%</span><br>
  <input id="speed" type="range" min="20" max="150" value="100">
</div>

<!--<div class="loading" id="loading">ƒêang t·∫£i √¢m thanh...</div>-->
<div class="gridABC" id="alphabetGrid"></div></div>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    padding: 20px;
  }
  h2 {
    text-align: center;
    color: #333;
  }
  #soTuBQT {
    text-align: center;
    margin: 10px 0;
    font-weight: bold;
    display: none;
  }
  #dsBQT {
    display: none;
    flex-direction: column;
    gap: 10px;
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  .card {
    background: white;
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .card:hover {
    background: #e0f7fa;
  }
  .mat-truoc, .mat-sau {
    display: none;
  }
  .card .mat-truoc {
    display: block;
  }
  .card.lat .mat-truoc {
    display: none;
  }
  .card.lat .mat-sau {
    display: block;
    color: #1e88e5;
  }
  #nutOanTuTi{
    display: block;
    margin: 10px auto;
    padding: 10px 20px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #nutOanTuTi:disabled {
    background: gray;
    cursor: not-allowed;
  }
  #khungChatOanTuTi {
      top:-400px;
      /* top:5px; */
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    background: #fff;
    display: none;
    max-height: 250px;
    overflow-y: auto;
    position:relative
  }
  #lichSuChatOanTuTi {
    max-height: 150px;
    overflow-y: auto;
    background: #f1f1f1;
    padding: 10px;
    margin-bottom: 10px;
    font-size: 14px;
  }
  #khungChatOanTuTi button.chon {
    margin-right: 10px;
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    background: #2196f3;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
  }
  .chon-active {
    background: #ff9800 !important;
    animation: nhapnhay 0.5s ease 2;
  }
  .nhap-nhay-lien {
    animation: blink 1s infinite;
    color: #d32f2f;
    font-weight: bold;
  }
  .ketqua {
    font-weight: bold;
  }
  .ketqua.thang { color: green; }
  .ketqua.thua { color: red; }
  .mau-do { color: red; font-style: italic; }
  @keyframes nhapnhay {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.5); }
  }
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  .dong-chat-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }
</style>
  
  </div>  <script>
   
     const speedCtrl = document.querySelector(".speed-control")
  const dsDongTuBQT = [

      { base: "go", past: "went", pastParticiple: "gone", type: "ƒë·ªông t·ª´", viet: "ƒëi", pronounce: "/g…ô ä/" },

      { base: "eat", past: "ate", pastParticiple: "eaten", type: "ƒë·ªông t·ª´", viet: "ƒÉn", pronounce: "/iÀêt/" },
      { base: "see", past: "saw", pastParticiple: "seen", type: "ƒë·ªông t·ª´", viet: "nh√¨n", pronounce: "/siÀê/" },
      { base: "come", past: "came", pastParticiple: "come", type: "ƒë·ªông t·ª´", viet: "ƒë·∫øn", pronounce: "/k åm/" },
      { base: "speak", past: "spoke", pastParticiple: "spoken", type: "ƒë·ªông t·ª´", viet: "n√≥i", pronounce: "/spiÀêk/" },
      { base: "write", past: "wrote", pastParticiple: "written", type: "ƒë·ªông t·ª´", viet: "vi·∫øt", pronounce: "/ra…™t/" },
      { base: "give", past: "gave", pastParticiple: "given", type: "ƒë·ªông t·ª´", viet: "cho", pronounce: "/…°…™v/" }
    ];
    const words = [
      { text: "run", mean: "ch·∫°y", type: "ƒë·ªông t·ª´", phonetic: "/r ån/", symbol: "v." },
      { text: "book", mean: "quy·ªÉn s√°ch", type: "danh t·ª´", phonetic: "/b äk/", symbol: "n." },
      { text: "quickly", mean: "m·ªôt c√°ch nhanh ch√≥ng", type: "tr·∫°ng t·ª´", phonetic: "/Ààkw…™k.li/", symbol: "adv." },
      { text: "happy", mean: "vui v·∫ª", type: "t√≠nh t·ª´", phonetic: "/Ààh√¶p.i/", symbol: "adj." },
      { text: "eat", mean: "ƒÉn", type: "ƒë·ªông t·ª´", phonetic: "/iÀêt/", symbol: "v." },
      { text: "slowly", mean: "m·ªôt c√°ch ch·∫≠m r√£i", type: "tr·∫°ng t·ª´", phonetic: "/Ààsl…ô ä.li/", symbol: "adv." },
      { text: "teacher", mean: "gi√°o vi√™n", type: "danh t·ª´", phonetic: "/ÀàtiÀê.t É…ôr/", symbol: "n." },
      { text: "beautiful", mean: "ƒë·∫πp", type: "t√≠nh t·ª´", phonetic: "/ÀàbjuÀê.t…™.f…ôl/", symbol: "adj." },
      { text: "laugh", mean: "c∆∞·ªùi", type: "ƒë·ªông t·ª´", phonetic: "/l…ëÀêf/", symbol: "v." },
      { text: "dog", mean: "con ch√≥", type: "danh t·ª´", phonetic: "/d…í…°/", symbol: "n." },
      { text: "kind", mean: "t·ªët b·ª•ng", type: "t√≠nh t·ª´", phonetic: "/ka…™nd/", symbol: "adj." },
      { text: "gently", mean: "nh·∫π nh√†ng", type: "tr·∫°ng t·ª´", phonetic: "/Ààd íent.li/", symbol: "adv." }
    ];

    const container = document.getElementById("cardContainer");
    const pagination = document.getElementById("pagination");
    const markedInfo = document.getElementById("markedInfo");
    const btnStudy = document.getElementById("btnStudy");
    const btnMarked = document.getElementById("btnMarked");

    let currentTab = "study";
    let currentPage = 1;
    const pageSize = 10;
    let marked = new Set(JSON.parse(localStorage.getItem("markedWords") || "[]"));

    function saveMarked() {
      localStorage.setItem("markedWords", JSON.stringify([...marked]));
    }

    
//     function showTab(tab) {
//   currentTab = tab;
//   currentPage = 1;

//   btnStudy.classList.toggle("active", tab === "study");
//   btnMarked.classList.toggle("active", tab === "marked");
//   document.getElementById("nutBatDauHoc").classList.toggle("active", tab === "bqt");

//   const markedInfo = document.getElementById("markedInfo");

//   if (tab === "study" || tab === "marked") {
//     document.getElementById("cardContainer").style.display = "block";
//     document.getElementById("pagination").style.display = "flex";
//     document.getElementById("soTuBQT").style.display = "none";
//     document.getElementById("dsBQT").style.display = "none";
//     document.getElementById("nutOanTuTi").style.display = "none";
//     markedInfo.style.display = "block";
//     renderCards();
//   } else if (tab === "bqt") {
//     document.getElementById("cardContainer").style.display = "none";
//     document.getElementById("pagination").style.display = "none";
//     document.getElementById("soTuBQT").style.display = "block";
//     document.getElementById("dsBQT").style.display = "flex";
//     document.getElementById("nutOanTuTi").style.display = "block";
//     markedInfo.style.display = "none";

//     // ‚úÖ CH√àN ƒêO·∫†N N√ÄY V√ÄO ƒê√ÇY
//     if (daHocBQT.length === 0) {
//       batDauHoc();
//     } else {
//       capNhatBQT();
//     }
//   } else if (tab == "bangChuCai") {
//     // ·∫®n t·∫•t c·∫£ tab
//   document.querySelectorAll('.tab').forEach(tab => {
//     tab.style.display = 'none';
//   });

//   // Hi·ªán tab ƒë∆∞·ª£c ch·ªçn
//     gridABC.style.display = 'flex';
//     speedCtrl.style.display = 'flex';
//   }
// }


function showTab(tab) {
  currentTab = tab;
  currentPage = 1;

  // ·∫®n t·∫•t c·∫£ .tab
  document.querySelectorAll('.tab').forEach(tab => {
    tab.style.display = 'none';
  });

  // Hi·ªán ƒë√∫ng tab c·∫ßn xem
  const selectedTab = document.getElementById('tab-' + tab);
  if (selectedTab) selectedTab.style.display = 'block';

  // ·∫®n/hi·ªán ph·∫ßn ri√™ng bi·ªát
  document.getElementById("cardContainer").style.display = (tab === "study" || tab === "marked") ? "block" : "none";
  document.getElementById("pagination").style.display = (tab === "study" || tab === "marked") ? "flex" : "none";
  document.getElementById("soTuBQT").style.display = (tab === "bqt") ? "block" : "none";
  document.getElementById("dsBQT").style.display = (tab === "bqt") ? "flex" : "none";
  document.getElementById("nutOanTuTi").style.display = (tab === "bqt") ? "block" : "none";
  document.querySelector(".speed-control").style.display = (tab === "bangChuCai") ? "block" : "none";
  //document.getElementById("loading").style.display = (tab === "bangChuCai") ? "block" : "none";
  document.getElementById("alphabetGrid").style.display = (tab === "bangChuCai") ? "grid" : "none";


  // N√∫t active
  btnStudy.classList.toggle("active", tab === "study");
  btnMarked.classList.toggle("active", tab === "marked");
  document.getElementById("nutBatDauHoc").classList.toggle("active", tab === "bqt");

  if (tab === "study" || tab === "marked") {
    markedInfo.style.display = "block";
    renderCards();
  } else {
    markedInfo.style.display = "none";
  }

  if (tab === "bqt") {
    if (daHocBQT.length === 0) {
      batDauHoc();
    } else {
      capNhatBQT();
    }
  }

//   if (tab === "bangChuCai") {
//   buildAlphabetGrid(); // g·ªçi ƒë·ªÉ render l·∫°i b·∫£ng ch·ªØ c√°i
//   document.getElementById("alphabetGrid").classList.add("show");
// }
if (tab === "bangChuCai") {
  loadVoiceAndThenBuild(); // ch·ªù voice xong m·ªõi render
  document.getElementById("alphabetGrid").classList.add("show");
}

}
////
function buildAlphabetGrid() {
  const gridABC = document.getElementById("alphabetGrid");
  
  gridABC.innerHTML = ""; // clear c≈©

  // const letters = "abcdefghijklmnopqrstuvwxyz".split("");
  // letters.forEach(letter => {
  //   const letterDiv = document.createElement("div");
  //   letterDiv.classList.add("letter");
  //   letterDiv.textContent = letter.toUpperCase(); // CH·ªñ N√ÄY QUAN TR·ªåNG
  //   alphabetGrid.appendChild(letterDiv);
  // });

  alphabet.forEach(item => {
  const div = document.createElement("div");
  div.className = "letter";
  div.innerHTML = `
    ${item.letter}<br><small>${item.phonetic}</small>
  `;
  div.addEventListener("click", () => speak(item.letter));
  gridABC.appendChild(div);
});
}



    function renderPagination(total) {
      pagination.innerHTML = "";
      const pageCount = Math.ceil(total / pageSize);
      for (let i = 1; i <= pageCount; i++) {
        const btn = document.createElement("div");
        btn.className = "page-number" + (i === currentPage ? " active" : "");
        btn.textContent = i;
        btn.onclick = () => {
          currentPage = i;
          renderCards();
        };
        pagination.appendChild(btn);
      }
    }

//     function renderCards() {
//   container.innerHTML = "";

//   const allWords = words.concat(dsDongTuBQT);
//   const listAll = currentTab === "study"
//     ? words
//     : allWords.filter(w => marked.has(w.text || w.base));

//   if (currentTab === "study") {
//     markedInfo.textContent = `ƒê√£ ƒë√°nh d·∫•u: ${marked.size}/${words.length}`;
//   } else {
//     markedInfo.textContent = `T·ªïng ƒë√£ ƒë√°nh d·∫•u: ${marked.size}`;
//   }

//   if (listAll.length === 0) {
//     container.innerHTML = '<div class="no-data">Ch∆∞a c√≥ t·ª´ n√†o ƒë∆∞·ª£c ƒë√°nh d·∫•u</div>';
//     pagination.innerHTML = "";
//     return;
//   }

//   renderPagination(listAll.length);
//   const list = listAll.slice((currentPage - 1) * pageSize, currentPage * pageSize);

//   list.forEach((word, index) => {
//     const wrapper = document.createElement("div");
//     wrapper.className = "card-wrapper " + (word.type || "").replace(/\s/g, "-");

//     const card = document.createElement("div");
//     card.className = "card";

//     const wordKey = word.text || word.base; // d√πng chung cho word v√† BQT
//     if (marked.has(wordKey)) card.classList.add("marked");

//     const front = document.createElement("div");
//     front.className = "card-front";
//     front.innerHTML = `
//       <span>${(currentPage - 1) * pageSize + index + 1}. ${word.mean || word.viet} (${word.type})</span>
//       <input type="checkbox" class="checkbox" ${marked.has(wordKey) ? "checked" : ""}>
//     `;

//     const back = document.createElement("div");
//     back.className = "card-back";
//     back.innerHTML = `
//       <div><strong>${word.text || `${word.base} - ${word.past} - ${word.pastParticiple}`}</strong> (${word.symbol || ""})</div>
//       <div>${word.phonetic || word.pronounce || ""}</div>
//       <div>${word.mean || ""}</div>
//     `;

//     card.appendChild(front);
//     card.appendChild(back);
//     wrapper.appendChild(card);
//     container.appendChild(wrapper);

//     const checkbox = front.querySelector("input");
//     checkbox.addEventListener("change", (e) => {
//       e.stopPropagation();
//       if (checkbox.checked) {
//         marked.add(wordKey);
//         card.classList.add("marked");
//       } else {
//         marked.delete(wordKey);
//         card.classList.remove("marked");
//       }
//       saveMarked();

//       if (currentTab === "study") {
//         markedInfo.textContent = `ƒê√£ ƒë√°nh d·∫•u: ${marked.size}/${words.length}`;
//       } else {
//         markedInfo.textContent = `T·ªïng ƒë√£ ƒë√°nh d·∫•u: ${marked.size}`;
//       }
//     });

//     card.addEventListener("click", (e) => {
//       if (e.target.tagName === "INPUT") return;
//       card.classList.add("flipped");
//       setTimeout(() => card.classList.remove("flipped"), 1500);
//     });
//   });
// }
   
function renderCards() {
  container.innerHTML = "";

  // 1) K·∫øt h·ª£p words + dsDongTuBQT, g·∫Øn key + flag bqt
 // m·ªõi: BQT l√™n tr∆∞·ªõc, study sau
const merged = [
  ...dsDongTuBQT.map(tu => ({
    key: tu.base,
    text: tu.base,
    mean: tu.viet,
    symbol: "",
    phonetic: tu.pronounce,
    type: "ƒë·ªông t·ª´",
    bqt: true
  })),
  ...words.map(w => ({
    key: w.text,
    text: w.text,
    mean: w.mean,
    symbol: w.symbol,
    phonetic: w.phonetic,
    type: w.type,
    bqt: false
  }))
];
  // 2) L·ªçc listAll tu·ª≥ tab, v√† l·ªçc marked-only n·∫øu tab marked
  let listAll;
  if (currentTab === "study") {
    listAll = words; 
  } else {
    // Ch·ªâ c√°c t·ª´ ƒë√£ ƒë√°nh d·∫•u, v√† lo·∫°i tr√πng theo key
    listAll = merged
      .filter(w => marked.has(w.key))
      .filter((w, i, a) => a.findIndex(x => x.key === w.key) === i);
  }

  // 3) C·∫≠p nh·∫≠t d√≤ng info
  if (currentTab === "study") {
    markedInfo.textContent = `ƒê√£ ƒë√°nh d·∫•u: ${marked.size}/${words.length}`;
  } else {
    markedInfo.textContent = `T·ªïng ƒë√£ ƒë√°nh d·∫•u: ${marked.size}`;
  }

  // 4) Tr∆∞·ªùng h·ª£p ch∆∞a c√≥ d·ªØ li·ªáu
  if (listAll.length === 0) {
    container.innerHTML = '<div class="no-data">Ch∆∞a c√≥ t·ª´ n√†o ƒë∆∞·ª£c ƒë√°nh d·∫•u</div>';
    pagination.innerHTML = "";
    return;
  }

  // 5) Pagination
  renderPagination(listAll.length);
  const list = listAll.slice((currentPage - 1) * pageSize, currentPage * pageSize);

  // 6) Render t·ª´ng card
  list.forEach((word, index) => {
    const wrapper = document.createElement("div");
    wrapper.className = "card-wrapper " + word.type.replace(/\s/g, "-");

    const card = document.createElement("div");
    card.className = "card";
    if (marked.has(word.key)) card.classList.add("marked");

    // M·∫∑t tr∆∞·ªõc
    const front = document.createElement("div");
    front.className = "card-front";
    front.innerHTML = `
      ${word.bqt
        ? `<span class="bqt-span">${index + 1}. ${word.mean} (${word.type} B·∫•t Quy T·∫Øc)</span>`
        : `<span>${index + 1}. ${word.mean} (${word.type})</span>`
      }
      <input type="checkbox" class="checkbox" ${marked.has(word.key) ? "checked" : ""}>
    `;

    // M·∫∑t sau
    const back = document.createElement("div");
    back.className = "card-back";
    back.innerHTML = `
      <div><strong>${word.key}</strong> ${word.symbol}</div>
      <div>${word.phonetic}</div>
      <div>${word.mean}</div>
    `;

    card.appendChild(front);
    card.appendChild(back);
    wrapper.appendChild(card);
    container.appendChild(wrapper);

    // Checkbox x·ª≠ l√Ω ƒë√°nh d·∫•u / b·ªè ƒë√°nh d·∫•u
    const checkbox = front.querySelector("input");
    checkbox.addEventListener("change", e => {
  e.stopPropagation();
  if (checkbox.checked) {
    marked.add(word.text);
    card.classList.add("marked");
  } else {
    marked.delete(word.text);
    card.classList.remove("marked");
  }
  saveMarked();
  // C·∫≠p nh·∫≠t s·ªë ·ªü header
  if (currentTab === "study") {
    markedInfo.textContent = `ƒê√£ ƒë√°nh d·∫•u: ${marked.size}/${words.length}`;
  } else {
    markedInfo.textContent = `T·ªïng ƒë√£ ƒë√°nh d·∫•u: ${marked.size}`;
  }
});

    // L·∫≠t th·∫ª
    card.addEventListener("click", e => {
      if (e.target.tagName === "INPUT") return;
      card.classList.add("flipped");
      setTimeout(() => card.classList.remove("flipped"), 1500);
    });
  });
}


function batDauOanTuTi() {
  document.getElementById("khungChatOanTuTi").style.display = "block";
}
// const dsDongTuBQT = [
//   { base: "go", past: "went", pastParticiple: "gone", type: "ƒë·ªông t·ª´", viet: "ƒëi", pronounce: "/…°…ô ä/" },
//   { base: "eat", past: "ate", pastParticiple: "eaten", type: "ƒë·ªông t·ª´", viet: "ƒÉn", pronounce: "/iÀêt/" },
//   // Th√™m ti·∫øp...
// ];

function xoaBoNho() {
  if (confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a h·∫øt d·ªØ li·ªáu ƒë√£ l∆∞u?")) {
    localStorage.clear();
    location.reload();
  }
}


    showTab("study");
  </script>
  

  <!-- b·∫•t qui t·∫Øc -->
  <script>
    
    let daHocBQT = [];
    let lichSuChat = JSON.parse(localStorage.getItem("lichSuChat") || "[]");
   /* function capNhatBQT() {
      const ds = document.getElementById("dsBQT");
      const daHocSo = daHocBQT.length;
      document.getElementById("soTuBQT").innerText = `ƒê√£ h·ªçc: ${daHocSo}/${dsDongTuBQT.length}`;
      document.getElementById("nutOanTuTi").disabled = (daHocSo === dsDongTuBQT.length);
      ds.innerHTML = "";
      daHocBQT.forEach((tu, i) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="mat-truoc">${i + 1}. ${tu.viet} (${tu.type})</div>
          <div class="mat-sau">${tu.base} - ${tu.past} - ${tu.pastParticiple}<br>${tu.pronounce}</div>
        `;
        card.onclick = () => card.classList.toggle("lat");
        ds.appendChild(card);
      });
    }*/

/*
function capNhatBQT() {
  const ds = document.getElementById("dsBQT");
  const daHocSo = daHocBQT.length;
  document.getElementById("soTuBQT").innerText = `ƒê√£ h·ªçc: ${daHocSo}/${dsDongTuBQT.length}`;
  document.getElementById("nutOanTuTi").disabled = (daHocSo === dsDongTuBQT.length);
  ds.innerHTML = "";

  daHocBQT.forEach((tu, i) => {
    const wrapper = document.createElement("div");
    wrapper.className = "card-wrapper " + tu.type.replace(/\s/g, "-");

    const card = document.createElement("div");
    card.className = "card marked"; // Cho ƒë√°nh d·∫•u m√†u cam m·∫∑c ƒë·ªãnh

    const front = document.createElement("div");
    front.className = "card-front";
    front.innerHTML = `<span>${i + 1}. ${tu.viet} (${tu.type})</span>`;

    const back = document.createElement("div");
    back.className = "card-back";
    back.innerHTML = `<div><strong>${tu.base} - ${tu.past} - ${tu.pastParticiple}</strong></div>
                      <div>${tu.pronounce}</div>`;

    card.appendChild(front);
    card.appendChild(back);
    wrapper.appendChild(card);
    ds.appendChild(wrapper);

    // L·∫≠t th·∫ª khi click
    card.addEventListener("click", () => {
      card.classList.add("flipped");
      setTimeout(() => card.classList.remove("flipped"), 1500);
    });
  });
}*/
function capNhatBQT() {
  const ds = document.getElementById("dsBQT");
  const daHocSo = daHocBQT.length;
  document.getElementById("soTuBQT").innerText = `ƒê√£ h·ªçc: ${daHocSo}/${dsDongTuBQT.length}`;
  document.getElementById("nutOanTuTi").disabled = (daHocSo === dsDongTuBQT.length);
  ds.innerHTML = "";

  daHocBQT.forEach((tu, i) => {
  const wrapper = document.createElement("div");
  wrapper.className = "card-wrapper " + tu.type.replace(/\s/g, "-");

  const card = document.createElement("div");
  card.className = "card";

  const checked = marked.has(tu.base);

  const front = document.createElement("div");
  front.className = "card-front";
  front.innerHTML = `
    <span style=" color: orange;
  font-weight: bold;
  font-size: 14px;
  margin-bottom: 4px">${i + 1}. ${tu.viet} (${tu.type} B·∫•t Quy T·∫Øc)</span>
    <input type="checkbox" class="checkbox" ${checked ? "checked" : ""}>
  `;

  if (checked) card.classList.add("marked");

  const back = document.createElement("div");
  back.className = "card-back";
  back.innerHTML = `
    <div><strong>${tu.base} - ${tu.past} - ${tu.pastParticiple}</strong></div>
    <div>${tu.pronounce}</div>
  `;

  card.appendChild(front);
  card.appendChild(back);
  wrapper.appendChild(card);
  ds.appendChild(wrapper);

  // ‚úÖ ƒê√¢y l√† ƒëo·∫°n fix l·ªói
  const checkbox = front.querySelector("input");
  const tuBase = tu.base;

  checkbox.addEventListener("change", () => {
    if (checkbox.checked) {
      card.classList.add("marked");
      marked.add(tuBase);
    } else {
      card.classList.remove("marked");
      marked.delete(tuBase);
    }
    saveMarked();
  });

  card.addEventListener("click", (e) => {
    if (e.target.tagName === "INPUT") return;
    card.classList.add("flipped");
    setTimeout(() => card.classList.remove("flipped"), 1500);
  });
});
}
    function batDauHoc() {
      const tuDauTien = dsDongTuBQT[0];
      daHocBQT = [tuDauTien];
      //document.getElementById("nutBatDauHoc").style.display = "none";
      document.getElementById("soTuBQT").style.display = "block";
      document.getElementById("dsBQT").style.display = "flex";
      document.getElementById("nutOanTuTi").style.display = "block";
      capNhatBQT();
    }
    function batDauOanTuTi() {
      document.getElementById("khungChatOanTuTi").style.display = "block";
      document.getElementById("huongDan").classList.add("nhap-nhay-lien");
      setButtonEnabled(true);
      renderChat();
    }
    function dongChat() {
      document.getElementById("khungChatOanTuTi").style.display = "none";
    }
    function renderChat() {
      const chat = document.getElementById("lichSuChatOanTuTi");
      chat.innerHTML = lichSuChat.map(line => `<div>${line}</div>`).join("");
  // Cu·ªôn ƒë·∫øn cu·ªëi c√πng c·ªßa ph·∫ßn chat
  chat.scrollTop = chat.scrollHeight;
    }
    function setButtonEnabled(enabled) {
      ["btnKeo", "btnBua", "btnBao"].forEach(id => {
        document.getElementById(id).disabled = !enabled;
        document.getElementById(id).style.opacity = enabled ? "1" : "0.5";
      });
    }
    function chonOanTuTi(nguoi) {
      const may = ["k√©o", "b√∫a", "bao"][Math.floor(Math.random() * 3)];
      setButtonEnabled(false);
      document.getElementById("huongDan").classList.remove("nhap-nhay-lien");
      const dong1 = `B·∫°n ch·ªçn <span style='color:blue'>${nguoi}</span>, m√°y ch·ªçn <span style='color:red'>${may}</span>`;
      const dong2 = tinhKetQua(nguoi, may);
      lichSuChat.push(`<div class='ketqua'>${dong1}</div>`);
      renderChat();
      setTimeout(() => {
        lichSuChat.push(`<div class='ketqua'>${dong2}</div>`);
        if (lichSuChat.length > 30) lichSuChat.shift();
        localStorage.setItem("lichSuChat", JSON.stringify(lichSuChat));
        renderChat();
        // Ch·ªù r·ªìi hi·ªán l·∫°i h∆∞·ªõng d·∫´n
        setTimeout(() => {
          document.getElementById("huongDan").classList.add("nhap-nhay-lien");
          setButtonEnabled(true);
        }, 1000);
      }, 1000);
    }
    function tinhKetQua(nguoi, may) {
      if (nguoi === may) return "H√≤a!";
      const win = (nguoi === "k√©o" && may === "bao") || (nguoi === "b√∫a" && may === "k√©o") || (nguoi === "bao" && may === "b√∫a");
      if (win) {
        const chuaHoc = dsDongTuBQT.filter(t => !daHocBQT.includes(t));
        if (chuaHoc.length > 0) {
          const moi = chuaHoc[Math.floor(Math.random() * chuaHoc.length)];
          daHocBQT.push(moi);
          capNhatBQT();
          return `<span class='ketqua thang'>=> B·∫°n Th·∫Øng! H·ªçc ƒë∆∞·ª£c t·ª´ m·ªõi: ${moi.viet}</span>`;
        } else {
          return "B·∫°n ƒë√£ h·ªçc h·∫øt r·ªìi!";
        }
      } else {
        if (daHocBQT.length > 1) {
          const indexXoa = Math.floor(Math.random() * daHocBQT.length);
          const mat = daHocBQT.splice(indexXoa, 1)[0];
          marked.delete(mat.base);     // Xo√° kh·ªèi danh s√°ch ƒë√£ ƒë√°nh d·∫•u
saveMarked();   
          capNhatBQT();
          return `<span class='ketqua thua'>=> Thua! M·∫•t t·ª´: ${mat.viet}</span>`;
        } else {
          return `<span class='mau-do'>B·∫°n Thua, <i>kh√¥ng c√≤n g√¨ ƒë·ªÉ m·∫•t</i></span>`;
        }
      }
    }
  </script>
   
   <!-- b·∫£ng ch·ªØ c√°i -->
  <script>

  
  // t·ªïng c√¢u m·ªói v√≤ng = alphabet.length * 2
  const totalQuestions = alphabet.length * 2;

  // state
  let currentCycle = 1;

  // 2) X√ÇY D·ª∞NG DANH S√ÅCH XEN K·∫º: [A, ei, B, biÀê, ‚Ä¶]
  function buildDanhSach() {
    danhSachNghe = [];
    alphabet.forEach(item => {
      danhSachNghe.push({
        kieu: "chu",
        hien: item.letter,
        traLoi: item.letter.toLowerCase()
      });
      danhSachNghe.push({
        kieu: "phienam",
        hien: item.letter,
        traLoi: item.phonetic.toLowerCase()
      });
    });
  }

  // 3) B·∫ÆT ƒê·∫¶U & HI·ªÇN TH·ªä POPUP
  function batDauLuyenNghe() {
  // Th·ª≠ kh√¥i ph·ª•c t·ª´ localStorage
  const saved = localStorage.getItem("luyenNgheState");
  if (saved) {
    const state = JSON.parse(saved);
    danhSachNghe = state.danhSachNghe;
    cauHoiIndex = state.cauHoiIndex;
    return showPopupAndNext();
  }

  // N·∫øu ch∆∞a c√≥ th√¨ t·∫°o m·ªõi
  cauHoiIndex = 0;
  const shuffledLetters = [...alphabet].sort(() => Math.random() - 0.5);
  const shuffledPhonetics = [...alphabet].sort(() => Math.random() - 0.5);
  danhSachNghe = [];

  for (let i = 0; i < alphabet.length; i++) {
    danhSachNghe.push({
      kieu: "chu",
      hien: shuffledLetters[i].letter,
      traLoi: shuffledLetters[i].letter.toLowerCase()
    });
    danhSachNghe.push({
      kieu: "phienam",
      hien: shuffledPhonetics[i].letter,
      traLoi: shuffledPhonetics[i].phonetic.toLowerCase()
    });
  }

  // L∆∞u v√†o localStorage ngay sau khi t·∫°o
  saveLuyenNgheState();
  showPopupAndNext();
}

function showPopupAndNext() {
  document.getElementById("popupLuyenNghe").style.display = "flex";
  hienCauHoi();
}
function saveLuyenNgheState() {
  localStorage.setItem("luyenNgheState", JSON.stringify({
    danhSachNghe,
    cauHoiIndex
  }));
}
  function dongLuyenNghe() {
    document.getElementById("popupLuyenNghe").style.display = "none";
  }

  // 4) HI·ªÇN TH·ªä C√ÇU H·ªéI & INFO V√íNG/ C√ÇU
  function hienCauHoi() {
    // n·∫øu qua h·∫øt th√¨ v√≤ng m·ªõi
    if (cauHoiIndex >= danhSachNghe.length) {
      cauHoiIndex = 0;
      currentCycle++;
    }
    document.getElementById("infoCycle").innerText =
      `V√≤ng ${currentCycle} ‚Äì C√¢u h·ªèi ${cauHoiIndex + 1}/${totalQuestions}`;

    cauHoiHienTai = danhSachNghe[cauHoiIndex];
    document.getElementById("cauHoiPopup").innerText =
      cauHoiHienTai.kieu === "chu"
        ? "ƒê√¢y l√† ch·ªØ g√¨?"
        : "Phi√™n √¢m c·ªßa ch·ªØ n√†y l√† g√¨?";
    document.getElementById("cauTraLoi").value = "";
    document.getElementById("thongBao").innerText = "";

    saveLuyenNgheState(); // l∆∞u ti·∫øn ƒë·ªô m·ªói l·∫ßn hi·ªán c√¢u m·ªõi

  }

  // 5) KI·ªÇM TRA ƒê√ÅP √ÅN (case-insensitive)
  function kiemTraCauTraLoi() {
    const inp = document.getElementById("cauTraLoi").value.trim().toLowerCase();
    const tb = document.getElementById("thongBao");
    if (!inp) {
      tb.innerText = "B·∫°n ch∆∞a nh·∫≠p g√¨!";
      tb.style.color = "orange";
      return;
    }
    if (inp === cauHoiHienTai.traLoi) {
      tb.innerText = "ƒê√∫ng!";
      tb.style.color = "green";
    } else {
      tb.innerHTML = `Sai! ƒê√°p √°n ƒë√∫ng: <b>${cauHoiHienTai.traLoi}</b>`;
      tb.style.color = "red";
    }
    setTimeout(() => {
      cauHoiIndex++;
      hienCauHoi();
    }, 1000);
  }


  document.getElementById("toggleKeyboard").onclick = () => {
    const kb = document.getElementById("phoneticKeyboard");
    kb.style.display = kb.style.display === "flex" ? "none" : "flex";
  };






  // L·∫•y t·∫•t c·∫£ k√Ω t·ª± IPA kh√¥ng ph·∫£i a-z
const phoneticSymbols = [...new Set(
  alphabet.flatMap(item =>
    item.phonetic.split('').filter(ch => !/[a-z]/.test(ch))
  )
)];

function setupPhoneticKeyboard() {
  const kb = document.getElementById("phoneticKeyboard");
  kb.innerHTML = ''; // Clear n·∫øu reload
  phoneticSymbols.forEach(sym => {
    const btn = document.createElement("button");
    btn.textContent = sym;
    btn.onclick = () => {
      const inp = document.getElementById("cauTraLoi");
      inp.value += sym;
      inp.focus();
    };
    kb.appendChild(btn);
  });
}

document.getElementById("toggleKeyboard").onclick = () => {
  const kb = document.getElementById("phoneticKeyboard");
  kb.style.display = kb.style.display === "flex" ? "none" : "flex";
  if (kb.style.display === "flex") kb.style.display = "flex";
};

window.addEventListener("load", setupPhoneticKeyboard);
</script>

</body>
</html>